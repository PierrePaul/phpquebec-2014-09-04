<!DOCTYPE html><html><head><title>PHPQuébec - Vagrant, c'est quoi?</title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link href="/css/prez.css" rel="stylesheet"><link href="//fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet" type="text/css"><script src="/js/jquery.min.js"></script><script src="/js/prez.js"></script><link href="//vjs.zencdn.net/4.7/video-js.css" rel="stylesheet"></head><body><div class="top"><span class="name">Pierre Paul Lefebvre</span><span class="usergroup">PHPQuébec</span></div><div id="impress"><div data-x="0" data-y="0" class="step slide"><h1>Vagrant, c'est quoi? </h1></div><div data-x="1000" data-y="0" class="step slide"><h2>Open-Source!</h2><img src="/images/happy-dog.jpg" class="happy-dog"><a href="https://www.flickr.com/photos/bs/3606756730">Creative Commons, Britt Selvitelle</a></div><div data-x="2000" data-y="0" class="step slide"><h2>Machines virtuelles </h2><p>Une marchine qui roue sur votre propre marchine.</p><p>Par exemple, une machine Linux fonctionne en même temps que votre MacOS.</p><hr><img src="/images/inception.jpg" width="100%"></div><div data-x="3000" data-y="0" class="step slide"><h2>Environnement</h2><p>Vagrant permet d'avoir un environnement identique à la production.</p><img src="/images/jennifer-lawrence-thumbs-up.gif" width="400px" class="lawrence"></div><div data-x="3000" data-y="1000" class="step slide"><h2>Plus sécuritaire</h2><p>Infrastructure en code = ♡</p><p>Facile d'avoir un topo complet et rend l'analyse de l'architecture beaucoup plus simple.</p></div><div data-x="3000" data-y="2000" class="step slide"><h2>Reproduisible</h2><p>N'importe qui peut prendre le projet et le faire rouler sur sa machine. Sans connaître en détail chaque pièce de l'infrastructure.</p></div><div data-x="3000" data-y="3000" class="step slide"><h2>Facile à déplacer</h2><img src="images/moving-boxes.jpg" class="moving-boxes"><span> 
Moving boxes &copy <a href="https://www.flickr.com/people/nathanoliverphotography/" target="blank">Nathan Oliver Photography,</a>Creative Commons</span></div><div data-x="4000" data-y="0" class="step slide"><h2>Installation</h2><p>Binaires pour presque toutes les plateformes!</p><a href="http://www.vagrantup.com/downloads.html">VagrantUp</a></div><div data-x="5000" data-y="0" class="step slide"><h2>Notions de base</h2><ul><li>Boxes</li><li>Provider</li><li>Provisioning</li><li>Multi-machine</li><li>Synced folders</li><li>Debugging</li></ul></div><div data-x="5000" data-y="1000" class="step slide"><h2>Boxes</h2><p>Chaque machine virtuelle se sert d'une boite de départ avec le bon système d'exploitation pré-installé, mais généralement non-configuré.</p></div><div data-x="5000" data-y="2000" class="step slide"><h2>Provider</h2><p>Peut être vu comme le "backend" pour les boîtes. Vagrant vient généralement avec Virtualbox comme provider par défaut, mais beaucoup d'autres existent.</p><ul><li>Digital Ocean</li><li>Amazon Web Services (AWS)</li><li>LXC</li><li>Docker</li><li>VMWare fusion</li><li>VMWare ESXI (vSphere)</li><li>etc.</li></ul><p>Certains viennent avec Vagrant, d'autres doivent être installé en tant que plugin.</p><hr><pre>vagrant plugin install vagrant-lxc</pre></div><div data-x="5000" data-y="3000" class="step slide"><h2>Provisioning</h2><p>Scripts et ou systèmes qui vont être utilisés pour configurer votre machine virtuelle.</p><ul><li>Chef</li><li>Puppet</li><li>Ansible ♥</li><li>Shell</li><li>CFEngine</li><li>Docker</li><li>Salt</li><li>etc.</li></ul></div><div data-x="5000" data-y="4000" class="step slide"><h2>Multi-machine</h2><p>Il est possible avec Vagrant de gérer plusieurs machines à l'intérieur d'un même projet Vagrant.</p><p>Très utile pour des architectures plus complexes.</p><img src="/images/project-vagrant-xyz.png" class="vagrant"></div><div data-x="5000" data-y="5000" class="step slide"><h2>Synced folders</h2><p>Permet de partager un ou des dossiers entre votre machine physique et votre machine virtuelle. </p><p>Très utile pour ceux qui veulent continuer d'utiliser Sublime plutôt que Vim/Emacs pour développer.</p><hr><pre>config.vm.synced_folder "projects/", "/var/www/"</pre></div><div data-x="6000" data-y="0" class="step slide"><h2>Première demo</h2><p>vagrant init (35s)</p><video controls preload="auto" width="100%" height="80%" class="video-js vjs-default-skin"><source src="/videos/demo-1.ogv" type="video/ogg"></video></div><div data-x="6000" data-y="1000" class="step slide"><h2>Deuxième demo</h2><p>Trouver une boîte vagrant (38s)</p><video controls preload="auto" width="100%" height="80%" class="video-js vjs-default-skin"><source src="/videos/demo-2.ogv" type="video/ogg"></video></div><div data-x="6000" data-y="2000" class="step slide"><h2>Troisième demo (3min18s)</h2><p>Ajouter la nouvelle boîte, vagrant up, vagrant ssh</p><video controls preload="auto" width="100%" height="80%" class="video-js vjs-default-skin"><source src="/videos/demo-3.ogv" type="video/ogg"></video></div><div data-x="6000" data-y="3000" class="step slide"><h2>Quatrième demo (1min6s)</h2><p>Provision : shell, inline</p><video controls preload="auto" width="100%" height="80%" class="video-js vjs-default-skin"><source src="/videos/demo-4-inline.ogv" type="video/ogg"></video></div><div data-x="6000" data-y="4000" class="step slide"><h2>Cinquième demo (2min7s)</h2><p>Provision : shell + ruby</p><video controls preload="auto" width="100%" height="80%" class="video-js vjs-default-skin"><source src="/videos/demo-4-full.ogv" type="video/ogg"></video></div><div data-x="7000" data-y="0" class="step slide"><h2>Use case: LVHockey</h2><p>Plateforme : Symfony2 (PHP)</p><img src="/images/lvhockey.png" width="100%"></div><div data-x="8000" data-y="0" class="step slide"><h2>Petits conseils</h2></div><div data-x="8000" data-y="1000" class="step slide"><h2>Utilisez les multi-machines</h2><p>Sans le savoir, peut-être qu'une nouvelle dépendance pour votre projet va agir différement si elle mise sur une autre machine.</p><p>Si cette dépendance se trouve sur un autre serveur en production, séparer là dans votre projet Vagrant.</p></div><div data-x="8000" data-y="2000" class="step slide"><h2>Jouer avec les différentes options de provisioning</h2><p>Toutes les options sont différentes et tous les goûts sont dans la nature.</p><p>Prennez un peu de temps pour trouver celle qui vous convient le mieux à vous et à votre entreprise.</p></div><div data-x="8000" data-y="3000" class="step slide"><h2>Symfony2</h2><p>Symfony, en mode débug, génère énormement de logs. En temps normal votre projet Symfony au complet sera en dossiers partagés avec votre machine physique. </p><p>Les dossiers partagés sont malheureusement très lents (selon le provider).</p><p>Pour réduire le temps d'écriture au fichier de log de votre application, déplacer les logs ailleurs et/ou faite un lien.</p><hr><pre>mv /var/www/project/app/logs /tmp/
ln -s /var/www/project/app/logs /tmp/logs</pre></div><div data-x="8000" data-y="4000" class="step slide"><h2>Debug</h2><pre>vagrant command --debug</pre><hr><video controls preload="auto" width="100%" height="80%" class="video-js vjs-default-skin"><source src="/videos/debug.ogv" type="video/ogg"></video></div><div data-x="8000" data-y="5000" class="step slide"><h2>Variables d'environement</h2><p>Certaines valeurs vont changer entre certrains environements.</p><p>Par exemple le mode debug va être désactivé pour Symfony.</p><p>C'est possible de passer des variables d'environement directement au provisioning pour qu'il fasse son boulot proprement.</p><pre>ansible.playbook = "provisioning/playbook.yml"
ansible.extra_vars = {
    "phero_environment" => ENV['ENVIRONMENT'],
    "fqdn" => fqdn,
    "domain" => domain,
    "vagrant_provider" => provider
}</pre><pre>ENVIRONEMENT=qa vagrant up</pre><p>Très utile avec Jenkins.</p></div><div data-x="8000" data-y="6000" class="step slide"><h2>Default provider</h2><p>Pour ceux qui décide de mettre VirtualBox de côté, vous pouvez changer votre provider par défaut via votre ~/.bashrc ou ~/.bash_profile</p><pre>export VAGRANT_DEFAULT_PROVIDER='lxc'</pre><p>Dans ce cas ci, chaque machine va être démarrée avec LXC plutôt que VirtualBox.</p><p>Gardez en tête que sur le poste de vos collègues, c'est toujours VirtualBox le défaut pour eux.</p></div><div data-x="9000" data-y="0" class="step slide"><h2>Questions?</h2><p>Présentation :</p><a href="http://phpquebec-2014-09-04.pierre-paul.com">http://phpquebec-2014-09-04.pierre-paul.com</a><p class="courriel">Courriel : <a href="https://www.pierre-paul.com/fr/#contact">info@pierre-paul.com</a></p><hr><h3>Merci!</h3><img src="/images/phpquebec.png" class="phpquebec"><img src="/images/LVHbeta_small_fr.png" class="lvh"></div></div><script type="text/javascript" src="js/impress.js"></script><script>impress().init();</script></body></html>